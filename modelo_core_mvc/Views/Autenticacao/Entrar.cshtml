@using Microsoft.AspNetCore.Authentication
@using modelo_core_mvc.Errors;
@using Microsoft.Extensions.Configuration
@using SefazLib.IdentityCfg;
@using SefazLib.usuarios
@using SefazLib.AzureUtils;
@inject IConfiguration Configuration
@inject AzureUtil azureUtil;
@inject IdentityConfig identityConfig;

@{
    var nomeExibicao = "Não autenticado";
    var foto = "";
    var jwt = "";
    if (User.Identity.IsAuthenticated)
    {
        nomeExibicao = @User.Identity.Name.Split(":")[0];
        if (Configuration["identity:type"] == "azuread")
        {
            try
            {
                Usuario usuario = await azureUtil.GetUserAsync();
                nomeExibicao = usuario.nomeCompleto;
                foto = usuario.foto;
                identityConfig.SetScope("ScopeForAccessToken");
                jwt = await identityConfig.obterAccessToken(null);
            }
            catch { }
        }
    }
}

<div>
    <h1>Usuário autenticado.</h1>
</div>